<html>
<head>
<meta http-equiv='cache-control' content='no-cache'>
<meta http-equiv='expires' content='0'>
<meta http-equiv='pragma' content='no-cache'>
<title>UK News Aggregator</title>
<script src="https://cdn.jsdelivr.net/gh/abdmob/x2js/xml2json.js"></script>
<script>

function matchingFunction(title, description){

	if ( description != "" )
	{
		if (description.match("oil") != null)
			return 1;
		else if (description.match("Oil") != null)
			return 1;
		else if (description.match("petrol") != null)
			return 1;
		else if (description.match("Petrol") != null)
			return 1;
		else if (description.match("OPEC") != null)
			return 1;
		else if (description.match("Natural Gas") != null)
			return 1;
		else if (description.match("natural gas") != null)
			return 1;
		else if (description.match("Wheat") != null)
			return 1;
		else if (description.match("wheat") != null)
			return 1;
		else if (description.match("Grain") != null)
			return 1;
		else if (description.match("grain") != null)
			return 1;
		else if (description.match("Inflation") != null)
			return 1;
		else if (description.match("inflation") != null)
			return 1;
		else if (description.match("Supply-Chain") != null)
			return 1;
		else if (description.match("supply-chain") != null)
			return 1;
		else if (description.match("Supply Chain") != null)
			return 1;
		else if (description.match("supply chain") != null)
			return 1;
		else if (description.match("Consumer Confidence") != null)
			return 1;
		else if (description.match("consumer confidence") != null)
			return 1;
		else if (description.match("Demand") != null)
			return 1;
		else if (description.match("demand") != null)
			return 1;
		else if (description.match("Consumer Price Index") != null)
			return 1;
		else if (description.match("consumer price index") != null)
			return 1;
		else if (description.match("CPI") != null)
			return 1;
		else if (description.match("Underground") != null)
			return 1;
		else if (description.match("underground") != null)
			return 1;
		else if (description.match("Tunnel") != null)
			return 1;
		else if (description.match("tunnel") != null)
			return 1;
		else if (description.match("Trench") != null)
			return 1;
		else if (description.match("trench") != null)
			return 1;
		else if (description.match("NHS") != null)
			return 1;
		else if (description.match("Dentist") != null)
			return 1;
		else if (description.match("dentist") != null)
			return 1;
		else if (description.match("Private Healthcare") != null)
			return 1;
		else if (description.match("private healthcare") != null)
			return 1;
		else if (description.match("Shipping") != null)
			return 1;
		else if (description.match("shipping") != null)
			return 1;
		else if (description.match("Dover") != null)
			return 1;
		else if (description.match("Airlines") != null)
			return 1;
		else if (description.match("airlines") != null)
			return 1;
		else if (description.match("Flights") != null)
			return 1;
		else if (description.match("flights") != null)
			return 1;
		else if (description.match("Backlog") != null)
			return 1;
		else if (description.match("backlog") != null)
			return 1;
		else if (description.match("Stagflation") != null)
			return 1;
		else if (description.match("stagflation") != null)
			return 1;
		else if (description.match("Sanctions") != null)
			return 1;
		else if (description.match("sanctions") != null)
			return 1;
		else if (description.match("Seafood") != null)
			return 1;
		else if (description.match("seafood") != null)
			return 1;
	}

	if (title != "")
	{
		if (title.match("oil") != null)
			return 1;
		else if (title.match("Oil") != null)
			return 1;
		else if (title.match("petrol") != null)
			return 1;
		else if (title.match("Petrol") != null)
			return 1;
		else if (title.match("OPEC") != null)
			return 1;
		else if (title.match("Natural Gas") != null)
			return 1;
		else if (title.match("natural gas") != null)
			return 1;
		else if (title.match("Wheat") != null)
			return 1;
		else if (title.match("wheat") != null)
			return 1;
		else if (title.match("Grain") != null)
			return 1;
		else if (title.match("grain") != null)
			return 1;
		else if (title.match("Inflation") != null)
			return 1;
		else if (title.match("inflation") != null)
			return 1;
		else if (title.match("Supply-Chain") != null)
			return 1;
		else if (title.match("supply-chain") != null)
			return 1;
		else if (title.match("Supply Chain") != null)
			return 1;
		else if (title.match("supply chain") != null)
			return 1;
		else if (title.match("Consumer Confidence") != null)
			return 1;
		else if (title.match("consumer confidence") != null)
			return 1;
		else if (title.match("Demand") != null)
			return 1;
		else if (title.match("demand") != null)
			return 1;
		else if (title.match("Consumer Price Index") != null)
			return 1;
		else if (title.match("consumer price index") != null)
			return 1;
		else if (title.match("CPI") != null)
			return 1;
		else if (title.match("Underground") != null)
			return 1;
		else if (title.match("underground") != null)
			return 1;
		else if (title.match("Tunnel") != null)
			return 1;
		else if (title.match("tunnel") != null)
			return 1;
		else if (title.match("Trench") != null)
			return 1;
		else if (title.match("trench") != null)
			return 1;
		else if (title.match("NHS") != null)
			return 1;
		else if (title.match("Dentist") != null)
			return 1;
		else if (title.match("dentist") != null)
			return 1;
		else if (title.match("Private Healthcare") != null)
			return 1;
		else if (title.match("private healthcare") != null)
			return 1;
		else if (title.match("Shipping") != null)
			return 1;
		else if (title.match("shipping") != null)
			return 1;
		else if (title.match("Dover") != null)
			return 1;
		else if (title.match("Airlines") != null)
			return 1;
		else if (title.match("airlines") != null)
			return 1;
		else if (title.match("Flights") != null)
			return 1;
		else if (title.match("flights") != null)
			return 1;
		else if (title.match("Backlog") != null)
			return 1;
		else if (title.match("backlog") != null)
			return 1;
		else if (title.match("Stagflation") != null)
			return 1;
		else if (title.match("stagflation") != null)
			return 1;
		else if (title.match("Sanctions") != null)
			return 1;
		else if (title.match("sanctions") != null)
			return 1;
		else if (title.match("Seafood") != null)
			return 1;
		else if (title.match("seafood") != null)
			return 1;
		else
			return 0;
	}
	else
		return 0;

}




function getTime(dateString)
{
var date = new Date(dateString);
return date.getTime();
}

var entries = [];

function sortByDate(a, b) {
    if (a[0] > b[0])
	return 1;
else return 0;
}


function updatepage(str, feed_name, index){

str=JSON.parse(str);
str=str.contents;

var x2js = new X2JS();
var myobj = x2js.xml_str2json(str);

for (i=0; i < myobj.rss.channel.item.length; i++)
{

var theEntry = '<a href="' + myobj.rss.channel.item[i].link + '">' + myobj.rss.channel.item[i].title + '</a>' + '<br>(' + feed_name + ": " + myobj.rss.channel.item[i].pubDate +')' + "<br><br>";
//alert(theEntry);
	if (typeof myobj.rss.channel.item[i].title !== 'undefined' || typeof myobj.rss.channel.item[i].description !== 'undefined')
	{

		if (typeof myobj.rss.channel.item[i].description === 'undefined')
		{

			if (matchingFunction(myobj.rss.channel.item[i].title,"") == 1){
				entries.push([getTime(myobj.rss.channel.item[i].pubDate), theEntry]);
			}
		}
		else if (typeof myobj.rss.channel.item[i].title === 'undefined')
		{

			if (matchingFunction("",myobj.rss.channel.item[i].description) == 1){
				entries.push([getTime(myobj.rss.channel.item[i].pubDate), theEntry]);
			}
		}
		else if (matchingFunction(myobj.rss.channel.item[i].title,myobj.rss.channel.item[i].description) == 1){

			entries.push([getTime(myobj.rss.channel.item[i].pubDate), theEntry]);
		}
	}

}

//document.body.innerHTML = JSON.stringify(myobj.item);

}

function xmlhttpPost(strURL, feed_name, index) {
var newurl = 'https://api.allorigins.win/json?' + 'nocache=' + Date.now() + '&' + 'url=';
//var newurl = 'https://api.allorigins.win/raw?url=';
    var url = newurl + strURL;

//here we use yahoo yql as a cors proxy
var newurl = '';
//"select title,link,pubDate from rss where url='"

    var xmlHttpReq = false;
    var self = this;
    if (window.XMLHttpRequest) { // Mozilla/Safari
        self.xmlHttpReq = new XMLHttpRequest();
    }
    else if (window.ActiveXObject) { // IE
        self.xmlHttpReq = new ActiveXObject("Microsoft.XMLHTTP");
    }

    self.xmlHttpReq.open('GET', newurl + url, false);
    self.xmlHttpReq.setRequestHeader('Content-Type', 'application/rss+xml');
    self.xmlHttpReq.onload = function() {
        if (self.xmlHttpReq.status == 200) {
            updatepage(self.xmlHttpReq.responseText, feed_name, index);
        }
    }

    self.xmlHttpReq.send();

}

function aggregate(){

var feed_urls = [
"https://www.theguardian.com/uk-news/rss",
"http://feeds.bbci.co.uk/news/world/rss.xml",
"http://feeds.bbci.co.uk/news/uk/rss.xml",
"http://feeds.feedburner.com/daily-express-news-showbiz",
"https://www.thesun.co.uk/feed/",
"https://metro.co.uk/feed/",
"http://feeds.skynews.com/feeds/rss/home.xml",
"http://www.dailymail.co.uk/news/index.rss",
"http://www.independent.co.uk/news/uk/rss",
"http://www.telegraph.co.uk/rss.xml",
"https://www.standard.co.uk/news/rss",
"https://www.huffingtonpost.co.uk/feeds/verticals/uk/index.xml"
]

var feed_names = [
"The Guardian",
"BBC [World]",
"BBC [UK]",
"The Express",
"The Sun",
"The Metro",
"Sky",
"The Daily Mail",
"The Independent",
"The Telegraph",
"The Evening Standard",
"HuffPost"
]

//Removed "The Daily Star","The Scotsman","Twitter","Trinity Mirror","Yahoo"

	for (index=0; index < feed_urls.length; ++index)
	{
		xmlhttpPost(feed_urls[index], feed_names[index], index)
	}

entries.sort(function(a, b) {
    return ((b[0] < a[0]) ? -1 : ((b[0] == a[0]) ? 0 : 1));
});

var newsout = "";
	for (index2=0; index2 < entries.length; ++ index2)
	{
		newsout = newsout + entries[index2][1];
	}
document.getElementById("theNews").innerHTML = "<center>" + newsout + "</center>";

}

</script>

<center>
</head>
<h2>All News:</h2>
<body onload="aggregate();">
<div id="theNews">Loading...</div>
</body>
</center>
</html>
